<div class="product-card">
  <a href="{% url 'product_detail' product.id %}" class="product-link">
    {% if product.image %}
      <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-img" loading="lazy">
    {% else %}
      <div class="product-img product-img--placeholder">
        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="8" y="18" width="48" height="34" rx="4" stroke="currentColor" stroke-width="2"/>
          <path d="M20 26L24 20H40L44 26" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <circle cx="32" cy="37" r="10" stroke="currentColor" stroke-width="2"/>
          <circle cx="32" cy="37" r="4" fill="currentColor"/>
        </svg>
        <span>–ù–µ—Ç —Ñ–æ—Ç–æ</span>
      </div>
    {% endif %}
    <div class="product-info">
      {% if product.brand %}
        <div class="product-brand"><a href="{% url 'brand_detail' product.brand_id %}">{{ product.brand.name }}</a></div>
      {% endif %}
      <div class="product-name">{{ product.name }}</div>
      <div class="product-price">{{ product.price }} ‚ÇΩ</div>
      <div class="product-stock {% if product.stock_quantity <= 0 %}out{% endif %}">
        {% if product.stock_quantity > 0 %}
          –í –Ω–∞–ª–∏—á–∏–∏: {{ product.stock_quantity }} —à—Ç.
        {% else %}
          –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
        {% endif %}
      </div>
    </div>
  </a>
  <div class="product-actions" style="padding:0 16px 16px;">
    {% if user.is_authenticated %}
      {% if product.stock_quantity > 0 %}
        <form class="product-form" action="{% url 'add_to_cart' product.id %}" method="post">
          {% csrf_token %}
          <input type="number" name="quantity" min="1" max="{{ product.stock_quantity }}" value="1" aria-label="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">
          <input type="hidden" name="next" value="{% firstof request.get_full_path '/catalog/' %}">
          <button type="submit" class="product-btn">üõí –î–æ–±–∞–≤–∏—Ç—å</button>
        </form>
      {% else %}
        <button type="button" class="product-btn" disabled>–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</button>
      {% endif %}
    {% else %}
      <a href="{% url 'login' %}?next={{ request.get_full_path }}" class="product-btn product-btn--ghost">–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</a>
    {% endif %}
  </div>
</div>
